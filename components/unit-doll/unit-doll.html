<link rel="import" href="../image-layer/image-layer.html">

<polymer-element name="unit-doll" flex on-resize="{{ resize }}">
	<template>
		<style>
			:host {

			}

			::content .layer {
				position: absolute;
				background-color: red;
				width:100px;
				height: 100px;

			}

			#frame {
				background-color: #fff;
				position: relative;
				overflow: hidden;
			}
		</style>

		<div id="frame">
			<template repeat="{{ layer in layers }}">
				<image-layer data="{{ layer }}" scale="{{ratio}}"></image-layer>
			</template>
		</div>

	</template>

	<script>
		Polymer({
			pixelRatio: 1000, // todo: 1000 is changeable var, depends on actor
			ratio:1,

			created:function(){
				var that = this;

				this.layers = [];

				$(window).resize(function(){
					that.resize()
				})
			},

			attached:function(){
				this.resize();
			},

			resize:function(){
				var that = this;

				// todo - make resizing snapped by 10px
				var frameSize = Math.min(this.offsetHeight, this.pixelRatio);
				this.ratio = frameSize / this.pixelRatio;

				$(this).find('.layer').css('transform', 'scale('+ this.ratio +')');

				$(this.$.frame).width(frameSize);
				$(this.$.frame).height(frameSize);
			},

			pushItem:function(data){
				console.log('instance push', data)

				_.each(data.layers, function(layer){
					this.layers.push(layer)
				}, this)
			}
		});
	</script>
</polymer-element>