<link rel="import" href="../card-agency/card-agency.html">

<polymer-element name="unit-agencies" vertical layout flex>
	<template>
		<style>
			:host {

			}

			#bookmark {
				width: 30px;
				background-color: #00bcd4;
				cursor: pointer;
				position: relative;
				text-align: center;
				overflow: hidden;
			}

			#scrollable {
				overflow-y: scroll;
				background-color: #fff;
			}

			.vertical {
				transform: rotate(270deg);
				position: absolute;
				top: 50%;
				left: -19px;
				color: #fff;
				font-weight: bold;
			}

			#scroll {
				padding: 15px 5px 1px 15px;
				position: relative;
			}

			core-toolbar {
				background-color: #00bcd4;
				color: #fff;
			}
		</style>

		<div id="bookmark" flex hidden?="{{!collapsed}}" on-tap="{{restore}}">
			<div class="vertical">{{currentAgency.title}}</div>
		</div>

		<core-toolbar class="core-narrow" hidden?="{{collapsed}}">
			<text-string>agencies.header</text-string>
		</core-toolbar>


		<div id="scrollable" hidden?="{{collapsed}}" flex>
			<div id="scroll">
				<template repeat="{{agency in nodes}}">
					<card-agency data="{{agency}}"></card-agency>
				</template>
			</div>
		</div>

	</template>

	<script>
		Polymer({

			publish:{
				flex:{
					default:true,
					reflect:true
				}
			},

			computed:{
				'flex':'!collapsed'
			},

			collapsed:false,

			eventDelegates:{
				'agency-selected':'onSelect'
			},

			ready:function(){
				this.nodes = [];
				this.subscribe();
			},

			subscribe:function(){
				app.connection.subscribe(this, 'agencies', {
					feed:'agencies'
				}, function(agencies){
					console.log('returned', agencies);

					this.nodes = agencies;
				})
			},

			onSelect:function(event, data){
				this.collapsed = true;
				this.currentAgency = data;
			},

			restore:function(){
				this.collapsed = false;
				this.fire('open-subunit', 'agencies')
			}

		});
	</script>
</polymer-element>